"use strict";var iSlider=function(t){if(!t.dom)throw new Error("dom element can not be empty!");if(!t.data||!t.data.length)throw new Error("data must be an array and must have more than one element!");this._opts=t,this._setting(),this._renderHTML(),this._bindHandler()};iSlider.prototype._setting=function(){var t=this._opts;this.wrap=t.dom,this.data=t.data,this.type=t.type||"pic",this.isVertical=t.isVertical||!1,this.isOverspread=t.isOverspread||!1,this.duration=t.duration||2e3,this.sliderIndex=this.sliderIndex||0,this.axis=this.isVertical?"Y":"X",this.width=this.wrap.clientWidth,this.height=this.wrap.clientHeight,this.ratio=this.height/this.width,this.scale=t.isVertical?this.height:this.width,this.onslide=t.onslide,this.onslidestart=t.onslidestart,this.onslideend=t.onslideend,this.onslidechange=t.onslidechange,this.data.length<2?(this.isLooping=!1,this.isAutoPlay=!1):(this.isLooping=t.isLooping||!1,this.isAutoplay=t.isAutoplay||!1),"card"===t.animateType&&this.isVertical&&(this.isOverspread=!0),this.isAutoplay&&this.play(),this.log=t.isDebug?function(t){window.console.log(t)}:function(){},this._setUpDamping(),this._setPlayWhenFocus(),this._animateFunc=t.animateType in this._animateFuncs?this._animateFuncs[t.animateType]:this._animateFuncs["default"]},iSlider.prototype._setPlayWhenFocus=function(){var t=this;window.addEventListener("focus",function(){t.isAutoplay&&t.play()},!1),window.addEventListener("blur",function(){t.pause()},!1)},iSlider.prototype._animateFuncs={"default":function(t,e,i,s,n){t.style.webkitTransform="translateZ(0) translate"+e+"("+(n+i*(s-1))+"px)"},rotate:function(t,e,i,s,n){var a="X"===e?"Y":"X",r=Math.abs(n),o=window.getComputedStyle(this.wrap.parentNode,null).backgroundColor;this.isVertical&&(n=-n),this.wrap.style.webkitPerspective=4*i,t.style.zIndex=1===s?i-r:n>0?(1-s)*r:(s-1)*r,t.style.cssText+="-webkit-backface-visibility:hidden; -webkit-transform-style:preserve-3d; background-color:"+o+"; position:absolute;",t.style.webkitTransform="rotate"+a+"("+90*(n/i+s-1)+"deg) translateZ("+.888*i/2+"px) scale(0.888)"},flip:function(t,e,i,s,n){var a="X"===e?"Y":"X",r=window.getComputedStyle(this.wrap.parentNode,null).backgroundColor;this.isVertical&&(n=-n),this.wrap.style.webkitPerspective=4*i,t.style.visibility=n>0?s>1?"hidden":"visible":1>s?"hidden":"visible",t.style.cssText+="position:absolute; -webkit-backface-visibility:hidden; background-color:"+r+";",t.style.webkitTransform="translateZ("+i/2+"px) rotate"+a+"("+180*(n/i+s-1)+"deg) scale(0.875)"},depth:function(t,e,i,s,n){var a=.18*(4-Math.abs(s-1));this.wrap.style.webkitPerspective=4*i,t.style.zIndex=1===s?100:n>0?1-s:s-1,t.style.webkitTransform="scale("+a+", "+a+") translateZ(0) translate"+e+"("+(n+1.3*i*(s-1))+"px)"},flow:function(t,e,i,s,n){var a=Math.abs(n),r="X"===e?"Y":"X",o="X"===e?1:-1,h=Math.abs(n/i);this.wrap.style.webkitPerspective=4*i,t.style.zIndex=1===s?i-a:n>0?(1-s)*a:(s-1)*a,t.style.webkitTransform="scale(0.7, 0.7) translateZ("+(150*h-150)*Math.abs(s-1)+"px)translate"+e+"("+(n+i*(s-1))+"px)rotate"+r+"("+o*(30-30*h)*(1-s)+"deg)"},card:function(t,e,i,s,n){var a=Math.abs(n);1===s?(t.style.zIndex=i-a,t.cur=1):t.style.zIndex=n>0?(1-s)*a*1e3:(s-1)*a*1e3,t.cur&&t.cur!==s&&setTimeout(function(){t.cur=null},300);var r=t.cur?1-.2*Math.abs(s-1)-Math.abs(.2*n/i).toFixed(6):1;t.style.webkitTransform="scale("+r+", "+r+") translateZ(0) translate"+e+"("+((1+.2*Math.abs(s-1))*n+i*(s-1))+"px)"}},iSlider.prototype._setUpDamping=function(){var t=this.scale>>1,e=t>>1,i=e>>2;this._damping=function(s){var n,a=Math.abs(s);return n=t>a?a>>1:t+e>a?e+(a-t>>2):e+i+(a-t-e>>3),s>0?n:-n}},iSlider.prototype._renderItem=function(t,e){var i,s,n=this.data.length;return i=this.isLooping?0>e?this.data[n+e]:e>n-1?this.data[e-n]:this.data[e]:this.data[e]||{empty:!0},i.empty?(t.innerHTML="",void(t.style.background="")):("pic"===this.type?this.isOverspread?t.style.background="url("+i.content+") 50% 50% / cover no-repeat":s=i.height/i.width>this.ratio?'<img height="'+this.height+'" src="'+i.content+'">':'<img width="'+this.width+'" src="'+i.content+'">':"dom"===this.type&&(s='<div style="height: 100%; width: 100%;">'+i.content+"</div>"),void(s&&(t.innerHTML=s)))},iSlider.prototype._renderHTML=function(){this.outer&&(this.outer.innerHTML="");var t=this.outer||document.createElement("ul");t.style.cssText="height:"+this.height+"px;width:"+this.width+"px;",this.els=[];for(var e=0;3>e;e++){var i=document.createElement("li");i.style.cssText="height:"+this.height+"px;width:"+this.width+"px;",this.els.push(i),this._animateFunc(i,this.axis,this.scale,e,0),!this.isVertical||"rotate"!==this._opts.animateType&&"flip"!==this._opts.animateType?this._renderItem(i,e-1+this.sliderIndex):this._renderItem(i,1-e+this.sliderIndex),t.appendChild(i)}this.outer||(this.outer=t,this.wrap.appendChild(t))},iSlider.prototype.slideTo=function(t){var e=this.data,i=this.els,s=t,n=t-this.sliderIndex;if(Math.abs(n)>1){var a=n>0?this.els[2]:this.els[0];this._renderItem(a,s)}e[s]?this.sliderIndex=s:this.isLooping?this.sliderIndex=n>0?0:e.length-1:(this.sliderIndex=this.sliderIndex,n=0),this.log("pic idx:"+this.sliderIndex);var r;!this.isVertical||"rotate"!==this._opts.animateType&&"flip"!==this._opts.animateType?n>0?(r=i.shift(),i.push(r)):0>n&&(r=i.pop(),i.unshift(r)):n>0?(r=i.pop(),i.unshift(r)):0>n&&(r=i.shift(),i.push(r)),0!==n&&(Math.abs(n)>1?(this._renderItem(i[0],s-1),this._renderItem(i[2],s+1)):1===Math.abs(n)&&this._renderItem(r,s+n),r.style.webkitTransition="none",r.style.visibility="hidden",setTimeout(function(){r.style.visibility="visible"},200),this.onslidechange&&this.onslidechange(this.sliderIndex));for(var o=0;3>o;o++)i[o]!==r&&(i[o].style.webkitTransition="all .3s ease"),this._animateFunc(i[o],this.axis,this.scale,o,0);this.isAutoplay&&!this.isLooping&&this.sliderIndex===e.length-1&&this.pause()},iSlider.prototype._bindHandler=function(){var t=this,e=!1,i=t.outer,s=!!("ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch),n=s?"touchstart":"mousedown",a=s?"touchmove":"mousemove",r=s?"touchend":"mouseup",o=function(i){e=!0,t.pause(),t.onslidestart&&t.onslidestart(),t.log("Event: beforeslide"),t.startTime=(new Date).getTime(),t.startX=s?i.targetTouches[0].pageX:i.pageX,t.startY=s?i.targetTouches[0].pageY:i.pageY},h=function(i){if(e){i.preventDefault(),t.onslide&&t.onslide(),t.log("Event: onslide");var n=t.data.length,a=t.axis,r=s?i.targetTouches[0]["page"+a]:i["page"+a],o=r-t["start"+a];t.isLooping||(o>0&&0===t.sliderIndex||0>o&&t.sliderIndex===n-1)&&(o=t._damping(o));for(var h=0;3>h;h++){var l=t.els[h];l.style.webkitTransition="all 0s",t._animateFunc(l,a,t.scale,h,o)}t.offset=o}},l=function(){e=!1;var i=t.offset,s=t.scale/2,n=(new Date).getTime();s=n-t.startTime>300?s:14,t.slideTo(i>=s?t.sliderIndex-1:-s>i?t.sliderIndex+1:t.sliderIndex),t.offset=0,t.isAutoplay&&t.play(),t.onslideend&&t.onslideend(),t.log("Event: afterslide")},d=function(){setTimeout(function(){t.reset(),t.log("Event: orientationchange")},100)};i.addEventListener(n,o),i.addEventListener(a,h),i.addEventListener(r,l),window.addEventListener("orientationchange",d)},iSlider.prototype.reset=function(){this.pause(),this._setting(),this._renderHTML(),this.isAutoplay&&this.play()},iSlider.prototype.play=function(){var t=this,e=this.duration;clearInterval(this.autoPlayTimer),this.autoPlayTimer=setInterval(function(){t.slideTo(t.sliderIndex+1)},e)},iSlider.prototype.pause=function(){clearInterval(this.autoPlayTimer)},iSlider.prototype.extend=function(t,e){e||(e=iSlider.prototype),Object.keys(t).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(t,i))})};